{"version":3,"file":"index.esm.js","sources":["../src/useWindowWidth.tsx","../src/Gallery.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react'\n\nexport default function useWindowWidth() {\n    const [width, setWidth] = useState<null|number>(null)\n\n    useEffect(() => {\n        const handleResize = () => setWidth(window.innerWidth)\n        window.addEventListener('resize', handleResize)\n        handleResize()\n        return () => window.removeEventListener('resize', handleResize)\n    }, [])\n\n    return width\n}","import React, { useState, useMemo, Dispatch, SetStateAction, ReactElement } from 'react'\nimport Image, { ImageLoader } from 'next/image'\nimport useWindowWidth from './useWindowWidth'\n\n\nexport interface Image {\n    src: string\n    aspect_ratio: number\n    alt?: string\n}\n\nexport interface NamedImage<NameT> extends Image {\n    name: NameT\n}\n\nexport type GalleryProps<NameT, StateT> = {\n    widths: number[]\n    ratios: number[]\n    percentVw?: number\n    margin?: string\n    initState?: StateT\n    imgLoader?: ImageLoader,\n    spanLastRow?: number,\n} & ({\n    images: NamedImage<NameT>[]\n    overlay: (name: NameT, state: StateT, setState: Dispatch<SetStateAction<StateT>>) => ReactElement\n}|{\n    images: Image[]\n    overlay?: undefined\n})\n\nexport function Gallery<NameT, StateT>({\n    images,\n    widths,\n    ratios,\n    percentVw = 100,\n    margin = '2px',\n    initState,\n    imgLoader,\n    overlay,\n    spanLastRow = 0,\n}: GalleryProps<NameT, StateT>) {\n\n    const [state, setState] = useState<StateT[]>(new Array(images.length).fill(initState))\n\n    const [sizes, width_left] = useMemo(() => {\n        const sizes: number[][] = []\n        const wl: number[] = []\n        for(const ratio of ratios) {\n            let current_ratio = 0\n            let width_percent: number[] = []\n            for(let i = 0; i < images.length; i++) {\n                if(current_ratio + images[i].aspect_ratio <= ratio) {\n                    current_ratio += images[i].aspect_ratio\n                } else {\n                    for(let j = width_percent.length; j < i; j++) {\n                        width_percent.push(Math.floor(images[j].aspect_ratio / current_ratio * 1000) / 10)\n                    }\n                    current_ratio=images[i].aspect_ratio\n                }\n            }\n            const width_left = Math.floor((1 - current_ratio / ratio) * 1000) / 10\n            const shouldSpan = 100-width_left < spanLastRow\n            for(let i = width_percent.length; i < images.length; i++) {\n                width_percent.push(Math.floor(images[i].aspect_ratio / (shouldSpan ? ratio : current_ratio) * 1000) / 10)\n            }\n            sizes.push(width_percent)\n            wl.push(shouldSpan ? width_left : 0)\n        }\n        return [sizes, wl]\n    }, [images, ratios])\n\n    const width = useWindowWidth()\n\n    const sizeLevel = useMemo(() => {\n        if(width === null) return null\n        const index = widths.findIndex(value => value > width)\n        return index === -1 ? ratios.length - 1 : index\n    }, [width, widths, ratios])\n\n    if (width == null || sizeLevel === null) return null\n\n    return (\n        <div style={{\n            display: 'flex',\n            flexWrap: 'wrap',\n        }}>\n            {images.map((image, index) => (\n                <div key={index} style={{\n                    boxSizing: 'border-box',\n                    width: sizes[sizeLevel][index]+'%',\n                    flexShrink: 0,\n                    flexGrow: 1,\n                    position: 'relative',\n                    paddingBottom: sizes[sizeLevel][index]/image.aspect_ratio+'%',\n                }}>\n                    <div style={{\n                        position: 'absolute',\n                        top: margin,\n                        left: margin,\n                        right: margin,\n                        bottom: margin,\n                    }}>\n                        <Image src={image.src} alt={image.alt??''} fill loader={imgLoader} sizes={widths.map((width, i) => `(max-width: ${width}px) ${percentVw/100*sizes[i][index]}vw`).join(', ')+`, ${percentVw/100*sizes[sizes.length-1][index]}vw`} />\n                        {overlay ? (\n                            <div style={{\n                                position: 'absolute',\n                                top: 0,\n                                left: 0,\n                                right: 0,\n                                bottom: 0,\n                            }}>\n                                {overlay((image as NamedImage<NameT>).name, state[index], arg => {\n                                    if(arg instanceof Function) setState(state.map((value, i) => i === index ? arg(value) : value))\n                                    else setState(state.map((value, i) => i === index ? arg : value))\n                                })}\n                            </div>\n                        ) : null}\n                    </div>\n                </div>\n            ))}\n            <div style={{\n                width: width_left[sizeLevel]+'%',\n                flexShrink: 0,\n                flexGrow: 1,\n            }}></div>\n        </div>\n    )\n}"],"names":["useWindowWidth","useState","width","setWidth","useEffect","handleResize","window","innerWidth","addEventListener","removeEventListener","Gallery","images","widths","ratios","percentVw","margin","initState","imgLoader","overlay","spanLastRow","Array","length","fill","state","setState","useMemo","sizes","wl","ratio","current_ratio","width_percent","i","aspect_ratio","j","push","Math","floor","width_left","shouldSpan","sizeLevel","index","findIndex","value","_jsxs","display","flexWrap","map","image","_jsx","boxSizing","flexShrink","flexGrow","position","paddingBottom","top","left","right","bottom","src","alt","join","name","arg","Function"],"mappings":"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"}